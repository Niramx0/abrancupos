{% extends 'HomePacientes.html' %}
{% load static %}
{% block volver %}
<a href="{% url 'homepacientes' %}" class="btn-editar">Volver</a>
{% endblock %}
{% block content %}
<div class="agendarcitas-container">  
    <h2 class="agendarcitas-titulo">Cancelar / Aplazar Citas</h2>

    {% if mensaje_exito %}
        <p class="mensaje-exito">{{ mensaje_exito }}</p>
    {% endif %}

    {% if mensaje_error %}
        <p class="mensaje-error">{{ mensaje_error }}</p>
    {% endif %}

    <form method="POST" id="form-citas">
        {% csrf_token %}

        <label class="agendarcitas-label">Seleccionar Cita</label>
        <select name="cita" id="cita-select" class="agendarcitas-select" required>
            <option value="">Seleccione una cita</option>
            {% for c in citas %}
                <option value="{{ c.idcitas_medicas }}">
                    {{ c.fecha }} — {{ c.hora }} — {{ c.idmedico.nombre }} {{ c.idmedico.apellido }}
                </option>
            {% endfor %}
        </select>

        <div style="margin-top:15px; display:flex; gap:10px;">
            <button type="button" id="btn-cancelar" class="agendarcitas-btn">Cancelar</button>
            <button type="button" id="btn-aplazar" class="agendarcitas-btn">Aplazar</button>
        </div>

        <!-- --- SECCIÓN CANCELAR --- -->
        <div id="seccion-cancelar" style="display:none; margin-top:20px;">
            <p class="mensaje-error">¿Estás seguro de cancelar la cita?</p>

            <button name="accion" value="confirmar_cancelar" class="agendarcitas-btn">Sí</button>
            <button type="button" id="cancelar-no" class="agendarcitas-btn">No</button>
        </div>

        <!-- --- SECCIÓN APLAZAR --- -->
        <div id="seccion-aplazar" style="display:none; margin-top:20px;">
            <label class="agendarcitas-label">Nueva Fecha</label>
            <input type="date" name="nueva_fecha" min="{{ hoy }}" class="agendarcitas-input">

            <label class="agendarcitas-label">Nueva Hora</label>
            <select name="nueva_hora" class="agendarcitas-select">
                <option value="">Seleccione hora</option>
                {% for h in horas %}
                    <option value="{{ h }}">{{ h }}</option>
                {% endfor %}
            </select>

            <button name="accion" value="confirmar_aplazar" class="agendarcitas-btn" style="margin-top:10px;">
                Guardar Cambios
            </button>
        </div>

    </form>
</div>

<script>
    const btnCancelar = document.getElementById("btn-cancelar");
    const btnAplazar = document.getElementById("btn-aplazar");
    const secCancelar = document.getElementById("seccion-cancelar");
    const secAplazar = document.getElementById("seccion-aplazar");
    const cancelarNo = document.getElementById("cancelar-no");

    btnCancelar.onclick = () => {
        secCancelar.style.display = "block";
        secAplazar.style.display = "none";
    };

    btnAplazar.onclick = () => {
        secAplazar.style.display = "block";
        secCancelar.style.display = "none";
    };

    cancelarNo.onclick = () => {
        secCancelar.style.display = "none";
    };
</script>

{% endblock %}